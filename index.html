<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Route Tracker</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .info-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            font-size: 12px;
            max-width: 200px;
            z-index: 1;
        }
    </style>
</head>
<body>
    <div id='map'></div>
    <div class='info-panel'>
        <strong>Route: E 12th St â†’ S Santa Fe Ave</strong><br>
        Distance: 0.9 miles<br>
        Duration: ~4 minutes<br>
        <span id='location-status'>Getting location...</span>
    </div>

    <script>
        // Wait for page to load completely
        window.addEventListener('load', function() {
            // Check if mapboxgl loaded
            if (typeof mapboxgl === 'undefined') {
                document.getElementById('location-status').innerHTML = 'MapBox failed to load';
                return;
            }

            mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
            
            // Your route coordinates
            const routeCoordinates = [
                [-118.2274002, 34.0225823], // Start: E 12th St
                [-118.2301251, 34.0227186],
                [-118.2302000, 34.0200000],
                [-118.2302600, 34.0180000],
                [-118.2303000, 34.0160000],
                [-118.2303400, 34.0140000],
                [-118.2303307, 34.0128273],
                [-118.2296805, 34.0128329],
                [-118.2296891, 34.0134287]  // End: S Santa Fe Ave
            ];

            try {
                const map = new mapboxgl.Map({
                    container: 'map',
                    style: 'mapbox://styles/mapbox/streets-v12',
                    center: [-118.2289, 34.0177],
                    zoom: 14
                });

                map.on('load', () => {
                    // Add route line
                    map.addSource('route', {
                        'type': 'geojson',
                        'data': {
                            'type': 'Feature',
                            'properties': {},
                            'geometry': {
                                'type': 'LineString',
                                'coordinates': routeCoordinates
                            }
                        }
                    });

                    map.addLayer({
                        'id': 'route',
                        'type': 'line',
                        'source': 'route',
                        'layout': {
                            'line-join': 'round',
                            'line-cap': 'round'
                        },
                        'paint': {
                            'line-color': '#1E90FF',
                            'line-width': 6
                        }
                    });

                    // Add start marker
                    new mapboxgl.Marker({ color: '#00FF00' })
                        .setLngLat([-118.2274002, 34.0225823])
                        .setPopup(new mapboxgl.Popup().setHTML('<strong>Start</strong><br>2480 E 12th St, Los Angeles'))
                        .addTo(map);

                    // Add end marker
                    new mapboxgl.Marker({ color: '#FF0000' })
                        .setLngLat([-118.2296891, 34.0134287])
                        .setPopup(new mapboxgl.Popup().setHTML('<strong>End</strong><br>2626 S Santa Fe Ave, Vernon'))
                        .addTo(map);

                    // User location tracking
                    let userMarker = null;
                    
                    if (navigator.geolocation) {
                        navigator.geolocation.watchPosition(
                            (position) => {
                                const { longitude, latitude } = position.coords;
                                
                                // Remove previous user marker
                                if (userMarker) {
                                    userMarker.remove();
                                }
                                
                                // Add new user marker
                                userMarker = new mapboxgl.Marker({ 
                                    color: '#004AAD',
                                    scale: 0.8
                                })
                                .setLngLat([longitude, latitude])
                                .setPopup(new mapboxgl.Popup().setHTML('<strong>Your Location</strong>'))
                                .addTo(map);
                                
                                // Update status
                                document.getElementById('location-status').innerHTML = `Your location: ${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
                            },
                            (error) => {
                                document.getElementById('location-status').innerHTML = 'Location unavailable';
                            },
                            {
                                enableHighAccuracy: true,
                                timeout: 20000,
                                maximumAge: 1000
                            }
                        );
                    } else {
                        document.getElementById('location-status').innerHTML = 'Geolocation not supported';
                    }
                });

                map.on('error', (e) => {
                    document.getElementById('location-status').innerHTML = 'Map error: ' + e.error.message;
                });

            } catch (error) {
                document.getElementById('location-status').innerHTML = 'Error: ' + error.message;
            }
        });
    </script>
</body>
</html>
