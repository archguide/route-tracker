<!DOCTYPE html>
<html>
<head>
    <title>Route Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #map { height: 100vh; width: 100%; }
        .info-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            max-width: 250px;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .status { margin-top: 10px; color: #666; font-size: 12px; }
        .button {
            background: #1E90FF;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="info-panel">
        <strong>Route: E 12th St â†’ S Santa Fe Ave</strong><br>
        Distance: <span id="distance">Calculating...</span><br>
        Duration: <span id="duration">Calculating...</span><br>
        <div class="status" id="location-status">Click button to get location</div>
        <button class="button" onclick="locateUser()">Get My Location</button>
        <button class="button" onclick="showRoute()">Show Route</button>
    </div>

    <script>
        let map;
        let directionsService;
        let directionsRenderer;
        let userMarker;

        // Route coordinates
        const startPoint = { lat: 34.0225823, lng: -118.2274002 };
        const endPoint = { lat: 34.0134287, lng: -118.2296891 };

        function initMap() {
            // Initialize map
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 14,
                center: { lat: 34.0177, lng: -118.2289 },
                mapTypeId: "roadmap",
            });

            // Initialize directions service and renderer
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                draggable: false,
                suppressMarkers: false,
            });
            directionsRenderer.setMap(map);

            // Add start marker
            new google.maps.Marker({
                position: startPoint,
                map: map,
                title: "Start: E 12th St",
                icon: {
                    url: "http://maps.google.com/mapfiles/ms/icons/green-dot.png"
                }
            });

            // Add end marker
            new google.maps.Marker({
                position: endPoint,
                map: map,
                title: "End: S Santa Fe Ave",
                icon: {
                    url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png"
                }
            });

            // Automatically show route on load
            showRoute();
        }

        function locateUser() {
            document.getElementById('location-status').innerHTML = 'Getting location...';
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const userPos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };

                        // Remove previous user marker
                        if (userMarker) {
                            userMarker.setMap(null);
                        }

                        // Add user marker
                        userMarker = new google.maps.Marker({
                            position: userPos,
                            map: map,
                            title: "Your Location",
                            icon: {
                                url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
                            }
                        });

                        // Update status
                        document.getElementById('location-status').innerHTML = 
                            `Your location: ${userPos.lat.toFixed(4)}, ${userPos.lng.toFixed(4)}`;

                        // Center map on user
                        map.setCenter(userPos);
                    },
                    (error) => {
                        let errorMsg = '';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMsg = 'Location access denied';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMsg = 'Location unavailable';
                                break;
                            case error.TIMEOUT:
                                errorMsg = 'Location timeout';
                                break;
                            default:
                                errorMsg = 'Location error';
                                break;
                        }
                        document.getElementById('location-status').innerHTML = errorMsg;
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 300000
                    }
                );
            } else {
                document.getElementById('location-status').innerHTML = 'Geolocation not supported';
            }
        }

        function showRoute() {
            const request = {
                origin: startPoint,
                destination: endPoint,
                travelMode: google.maps.TravelMode.DRIVING,
                unitSystem: google.maps.UnitSystem.IMPERIAL,
                avoidHighways: false,
                avoidTolls: false,
            };

            directionsService.route(request, (result, status) => {
                if (status === "OK") {
                    directionsRenderer.setDirections(result);
                    
                    // Update distance and duration
                    const route = result.routes[0];
                    const leg = route.legs[0];
                    
                    document.getElementById('distance').innerHTML = leg.distance.text;
                    document.getElementById('duration').innerHTML = leg.duration.text;
                } else {
                    console.error('Directions request failed due to ' + status);
                    document.getElementById('distance').innerHTML = 'Error';
                    document.getElementById('duration').innerHTML = 'Error';
                }
            });
        }

        // Auto-locate user every 30 seconds
        setInterval(() => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const userPos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };

                        if (userMarker) {
                            userMarker.setPosition(userPos);
                            document.getElementById('location-status').innerHTML = 
                                `Your location: ${userPos.lat.toFixed(4)}, ${userPos.lng.toFixed(4)}`;
                        }
                    },
                    () => {}, // Ignore errors for auto-updates
                    { enableHighAccuracy: true, timeout: 5000, maximumAge: 30000 }
                );
            }
        }, 30000);
    </script>

    <!-- Load Google Maps JavaScript API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDDdD8BAz34j_0zv-G3qJKTP5sKQn7PQ1w&callback=initMap&libraries=geometry" async defer></script>
</body>
</html>
